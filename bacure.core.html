<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>bacure.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Bacure 0.3.13 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="bacure.coerce.html"><span>bacure.coerce</span></a></li><li class="current"><a href="bacure.core.html"><span>bacure.core</span></a></li><li><a href="bacure.local-device.html"><span>bacure.local-device</span></a></li><li><a href="bacure.local-save.html"><span>bacure.local-save</span></a></li><li><a href="bacure.network.html"><span>bacure.network</span></a></li><li><a href="bacure.read-properties.html"><span>bacure.read-properties</span></a></li><li><a href="bacure.remote-device.html"><span>bacure.remote-device</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="bacure.core.html#var-boot-up"><span>boot-up</span></a></li><li><a href="bacure.core.html#var-find-bacnet-port"><span>find-bacnet-port</span></a></li><li><a href="bacure.core.html#var-find-objects"><span>find-objects</span></a></li><li><a href="bacure.core.html#var-find-objects-everywhere"><span>find-objects-everywhere</span></a></li><li><a href="bacure.core.html#var-get-device-id"><span>get-device-id</span></a></li><li><a href="bacure.core.html#var-remote-object-properties"><span>remote-object-properties</span></a></li><li><a href="bacure.core.html#var-remote-object-properties-with-nil"><span>remote-object-properties-with-nil</span></a></li><li><a href="bacure.core.html#var-remote-objects"><span>remote-objects</span></a></li><li><a href="bacure.core.html#var-remote-objects-all-properties"><span>remote-objects-all-properties</span></a></li><li><a href="bacure.core.html#var-where"><span>where</span></a></li><li><a href="bacure.core.html#var-where-or-not-found"><span>where-or-not-found</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>bacure.core documentation</h2><pre class="doc"></pre><div class="public" id="var-boot-up"><h3>boot-up</h3><div class="usage"><code>(boot-up)</code></div><pre class="doc">Create a local-device, load its config file, initialize it, and
find the remote devices.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L8">Source</a></div></div><div class="public" id="var-find-bacnet-port"><h3>find-bacnet-port</h3><div class="usage"><code>(find-bacnet-port &amp; {:keys [delay port-min port-max], :or {delay 500, port-min 47801, port-max 47820}})</code></div><pre class="doc">Scan ports to see if any BACnet device will respond. If the
optionals port-min and port-max aren't given, default to all ports
between 47801 and 47820.

By default each port will wait 500 ms for an answer. Consequently,
if you test 20 ports, it will take 10 seconds.

Example use:
(find-bacnet-port) ;;will take 10s to scan ports 47801 to 47820
(find-bacnet-port :delay 100) ;; scan the same ports, but faster
(find-bacnet-port :port-min 47850 :port-max 47900) ;;new port range

Even if we could simply send a WhoIs on another port, some BACnet
devices have bad behaviour and send data back to 'their' port,
regardless from which port the WhoIs came. In other to maximize our
chances of finding them, we reset the local device with a new port
each time.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L15">Source</a></div></div><div class="public" id="var-find-objects"><h3>find-objects</h3><div class="usage"><code>(find-objects device-id criteria-map)</code><code>(find-objects device-id criteria-map object-identifiers)</code></div><pre class="doc">Return a list of objects-maps (properties) matching the criteria-map.

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #&quot;(?i)analog&quot; :model-name &quot;GNU&quot;}

Each different* property is requested individually, which requires
a higher traffic on the network. However, it also enables us to
stop a query if one of the properties values isn't what we wished.
Useful if we want to find devices with particular properties.

If the criteria-map fails, any unfetched properties will just be
dropped, saving some traffic on the network. Can quickly become
advantageous if we query a large number of devices.

* In case of multiple objects, if segmentation is supported, the
  same property is retrieved in a single request. For example, the
  `description' property for 3 different objects would be merged
  into a single request.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L157">Source</a></div></div><div class="public" id="var-find-objects-everywhere"><h3>find-objects-everywhere</h3><div class="usage"><code>(find-objects-everywhere criteria-map)</code><code>(find-objects-everywhere criteria-map object-identifiers)</code></div><pre class="doc">Same as `find-objects', but will search every known devices on the network.
Group the result in a map where the device object identifier is the
key. E.g. [:device 1234]

Thus, to retrieve the result for a given device, simply do:
(get &lt;result&gt; [:device 1234]).

One could also get the list of devices in which a result matched with:
(keys &lt;result&gt;).

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #&quot;(?i)analog&quot; :model-name &quot;GNU&quot;}

All remote devices are queried simultaneously (or as much as the
local-device can allow).</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L191">Source</a></div></div><div class="public" id="var-get-device-id"><h3>get-device-id</h3><div class="usage"><code>(get-device-id device-map)</code></div><pre class="doc">Return the device-id from a device-map (bunch of properties).

This can be used to search the device-id amongst all the properties
returned by (remote-objects-all-properties &lt;some-device-id&gt;).</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L92">Source</a></div></div><div class="public" id="var-remote-object-properties"><h3>remote-object-properties</h3><div class="usage"><code>(remote-object-properties device-id object-identifiers properties)</code></div><pre class="doc">Query a remote device and return the properties values
Example: (remote-object-properties 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers' and `properties' accept either a single
item or a collection.

Discards any properties with a `nil' value (property not found in object).</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L66">Source</a></div></div><div class="public" id="var-remote-object-properties-with-nil"><h3>remote-object-properties-with-nil</h3><div class="usage"><code>(remote-object-properties-with-nil device-id object-identifiers properties)</code></div><pre class="doc">Query a remote device and return the properties values
Example: (object-properties-values 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers' and `properties' accept either a single
item or a collection.

You probably want to use `remote-object-properties'.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L52">Source</a></div></div><div class="public" id="var-remote-objects"><h3>remote-objects</h3><div class="usage"><code>(remote-objects device-id)</code></div><pre class="doc">Return a collection of every objects in the remote device.
-&gt; [[:device 1234] [:analog-input 0]...]</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L80">Source</a></div></div><div class="public" id="var-remote-objects-all-properties"><h3>remote-objects-all-properties</h3><div class="usage"><code>(remote-objects-all-properties device-id)</code></div><pre class="doc">Return a list of maps of every objects and their properties.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L87">Source</a></div></div><div class="public" id="var-where"><h3>where</h3><div class="usage"><code>(where criteria)</code></div><pre class="doc">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, fail.

For example:
Criteria map:  {:a #(&gt; % 10) :b &quot;foo&quot;}
Tested-maps  {:a 20 :b &quot;foo&quot;}  success
             {:b &quot;foo&quot;}        fail
             {:a nil :b &quot;foo&quot;} fail</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L119">Source</a></div></div><div class="public" id="var-where-or-not-found"><h3>where-or-not-found</h3><div class="usage"><code>(where-or-not-found criteria)</code></div><pre class="doc">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, pass.

For example:
Criteria map:  {:a #(&gt; % 10) :b &quot;foo&quot;}
Tested-maps  {:a 20 :b &quot;foo&quot;}  success
             {:b &quot;foo&quot;}        success
             {:a nil :b &quot;foo&quot;} fail</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L133">Source</a></div></div></div></body></html>