<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>bacure.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Bacure 0.4.12 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bacure</span></div></div></li><li class="depth-2 branch"><a href="bacure.coerce.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coerce</span></div></a></li><li class="depth-2 branch current"><a href="bacure.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="bacure.local-device.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>local-device</span></div></a></li><li class="depth-2 branch"><a href="bacure.local-save.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>local-save</span></div></a></li><li class="depth-2 branch"><a href="bacure.network.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>network</span></div></a></li><li class="depth-2 branch"><a href="bacure.read-properties.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>read-properties</span></div></a></li><li class="depth-2"><a href="bacure.remote-device.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>remote-device</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="bacure.core.html#var-boot-up"><div class="inner"><span>boot-up</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-find-bacnet-port"><div class="inner"><span>find-bacnet-port</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-find-objects"><div class="inner"><span>find-objects</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-find-objects-everywhere"><div class="inner"><span>find-objects-everywhere</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-get-device-id"><div class="inner"><span>get-device-id</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-read-trend-log"><div class="inner"><span>read-trend-log</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-object-properties"><div class="inner"><span>remote-object-properties</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-object-properties-with-nil"><div class="inner"><span>remote-object-properties-with-nil</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-objects"><div class="inner"><span>remote-objects</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-objects-all-properties"><div class="inner"><span>remote-objects-all-properties</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-where"><div class="inner"><span>where</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-where-or-not-found"><div class="inner"><span>where-or-not-found</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">bacure.core</h2><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-boot-up"><h3>boot-up</h3><div class="usage"><code>(boot-up &amp; configs)</code></div><div class="doc"><pre class="plaintext">Create a local-device, load its config file, initialize it, and
find the remote devices.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L8">view source</a></div></div><div class="public anchor" id="var-find-bacnet-port"><h3>find-bacnet-port</h3><div class="usage"><code>(find-bacnet-port &amp; {:keys [delay port-min port-max], :or {delay 500, port-min 47801, port-max 47820}})</code></div><div class="doc"><pre class="plaintext">Scan ports to see if any BACnet device will respond. If the
optionals port-min and port-max aren&apos;t given, default to all ports
between 47801 and 47820.

By default each port will wait 500 ms for an answer. Consequently,
if you test 20 ports, it will take 10 seconds.

Example use:
(find-bacnet-port) ;;will take 10s to scan ports 47801 to 47820
(find-bacnet-port :delay 100) ;; scan the same ports, but faster
(find-bacnet-port :port-min 47850 :port-max 47900) ;;new port range

Even if we could simply send a WhoIs on another port, some BACnet
devices have bad behaviour and send data back to &apos;their&apos; port,
regardless from which port the WhoIs came. In other to maximize our
chances of finding them, we reset the local device with a new port
each time.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L16">view source</a></div></div><div class="public anchor" id="var-find-objects"><h3>find-objects</h3><div class="usage"><code>(find-objects device-id criteria-map)</code><code>(find-objects device-id criteria-map object-identifiers)</code></div><div class="doc"><pre class="plaintext">Return a list of objects-maps (properties) matching the criteria-map.

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #&quot;(?i)analog&quot; :model-name &quot;GNU&quot;}

Each different* property is requested individually, which requires
a higher traffic on the network. However, it also enables us to
stop a query if one of the properties values isn&apos;t what we wished.
Useful if we want to find devices with particular properties.

If the criteria-map fails, any unfetched properties will just be
dropped, saving some traffic on the network. Can quickly become
advantageous if we query a large number of devices.

* In case of multiple objects, if segmentation is supported, the
  same property is retrieved in a single request. For example, the
  `description&apos; property for 3 different objects would be merged
  into a single request.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L176">view source</a></div></div><div class="public anchor" id="var-find-objects-everywhere"><h3>find-objects-everywhere</h3><div class="usage"><code>(find-objects-everywhere criteria-map)</code><code>(find-objects-everywhere criteria-map object-identifiers)</code></div><div class="doc"><pre class="plaintext">Same as `find-objects&apos;, but will search every known devices on the network.
Group the result in a map where the device object identifier is the
key. E.g. [:device 1234]

Thus, to retrieve the result for a given device, simply do:
(get &lt;result&gt; [:device 1234]).

One could also get the list of devices in which a result matched with:
(keys &lt;result&gt;).

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #&quot;(?i)analog&quot; :model-name &quot;GNU&quot;}

All remote devices are queried simultaneously (or as much as the
local-device can allow).</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L210">view source</a></div></div><div class="public anchor" id="var-get-device-id"><h3>get-device-id</h3><div class="usage"><code>(get-device-id device-map)</code></div><div class="doc"><pre class="plaintext">Return the device-id from a device-map (bunch of properties).

This can be used to search the device-id amongst all the properties
returned by (remote-objects-all-properties &lt;some-device-id&gt;).</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L108">view source</a></div></div><div class="public anchor" id="var-read-trend-log"><h3>read-trend-log</h3><div class="usage"><code>(read-trend-log device-id object-identifier)</code></div><div class="doc"><pre class="plaintext">A convenience function to retrieve all data from a trend-log (even the log-buffer).

Example:  (read-trend-log 4589 [:trend-log 1])
-&gt; {:object-name &quot;Trend Log 1&quot;,
    :start-time &quot;2009-01-01T05:00:00.000Z&quot;,
    :log-buffer
    [[&quot;2009-03-01T07:15:00.000Z&quot; 1009.0]
     [&quot;2009-03-01T07:30:00.000Z&quot; 1010.0]...]...}</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L88">view source</a></div></div><div class="public anchor" id="var-remote-object-properties"><h3>remote-object-properties</h3><div class="usage"><code>(remote-object-properties device-id object-identifiers properties)</code></div><div class="doc"><pre class="plaintext">Query a remote device and return the properties values
Example: (remote-object-properties 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers&apos; and `properties&apos; accept either a single
item or a collection.

Discards any properties with a `nil&apos; value (property not found in object).</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L67">view source</a></div></div><div class="public anchor" id="var-remote-object-properties-with-nil"><h3>remote-object-properties-with-nil</h3><div class="usage"><code>(remote-object-properties-with-nil device-id object-identifiers properties)</code></div><div class="doc"><pre class="plaintext">Query a remote device and return the properties values
Example: (remote-object-properties-with-nil 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers&apos; and `properties&apos; accept either a single
item or a collection.

You probably want to use `remote-object-properties&apos;.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L53">view source</a></div></div><div class="public anchor" id="var-remote-objects"><h3>remote-objects</h3><div class="usage"><code>(remote-objects device-id)</code></div><div class="doc"><pre class="plaintext">Return a collection of every objects in the remote device.
-&gt; [[:device 1234] [:analog-input 0]...]</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L81">view source</a></div></div><div class="public anchor" id="var-remote-objects-all-properties"><h3>remote-objects-all-properties</h3><div class="usage"><code>(remote-objects-all-properties device-id)</code></div><div class="doc"><pre class="plaintext">Return a list of maps of every objects and their properties.
</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L103">view source</a></div></div><div class="public anchor" id="var-where"><h3>where</h3><div class="usage"><code>(where criteria)</code></div><div class="doc"><pre class="plaintext">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, fail.

For example:
Criteria map:  {:a #(&gt; % 10) :b &quot;foo&quot;}
Tested-maps  {:a 20 :b &quot;foo&quot;}  success
             {:b &quot;foo&quot;}        fail
             {:a nil :b &quot;foo&quot;} fail</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L138">view source</a></div></div><div class="public anchor" id="var-where-or-not-found"><h3>where-or-not-found</h3><div class="usage"><code>(where-or-not-found criteria)</code></div><div class="doc"><pre class="plaintext">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, pass.

For example:
Criteria map:  {:a #(&gt; % 10) :b &quot;foo&quot;}
Tested-maps  {:a 20 :b &quot;foo&quot;}  success
             {:b &quot;foo&quot;}        success
             {:a nil :b &quot;foo&quot;} fail</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/mastersrc/bacure/core.clj#L152">view source</a></div></div></div></body></html>