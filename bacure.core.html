<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>bacure.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Bacure 0.1.7 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="bacure.coerce.html"><span>bacure.coerce</span></a></li><li class="current"><a href="bacure.core.html"><span>bacure.core</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="bacure.core.html#var-add-object"><span>add-object</span></a></li><li><a href="bacure.core.html#var-add-or-update-object"><span>add-or-update-object</span></a></li><li><a href="bacure.core.html#var-boot-up"><span>boot-up</span></a></li><li><a href="bacure.core.html#var-clear-all%21"><span>clear-all!</span></a></li><li><a href="bacure.core.html#var-create-remote-object"><span>create-remote-object</span></a></li><li><a href="bacure.core.html#var-delete-remote-object"><span>delete-remote-object</span></a></li><li><a href="bacure.core.html#var-find-objects"><span>find-objects</span></a></li><li><a href="bacure.core.html#var-find-objects-everywhere"><span>find-objects-everywhere</span></a></li><li><a href="bacure.core.html#var-find-remote-devices"><span>find-remote-devices</span></a></li><li><a href="bacure.core.html#var-find-remote-devices-and-extended-information"><span>find-remote-devices-and-extended-information</span></a></li><li><a href="bacure.core.html#var-initialize"><span>initialize</span></a></li><li><a href="bacure.core.html#var-load-local-device-backup"><span>load-local-device-backup</span></a></li><li><a href="bacure.core.html#var-local-device-backup"><span>local-device-backup</span></a></li><li><a href="bacure.core.html#var-local-objects"><span>local-objects</span></a></li><li><a href="bacure.core.html#var-mapify"><span>mapify</span></a></li><li><a href="bacure.core.html#var-new-local-device"><span>new-local-device</span></a></li><li><a href="bacure.core.html#var-rd"><span>rd</span></a></li><li><a href="bacure.core.html#var-remote-devices"><span>remote-devices</span></a></li><li><a href="bacure.core.html#var-remote-devices-and-names"><span>remote-devices-and-names</span></a></li><li><a href="bacure.core.html#var-remote-object-properties"><span>remote-object-properties</span></a></li><li><a href="bacure.core.html#var-remote-object-properties-with-nil"><span>remote-object-properties-with-nil</span></a></li><li><a href="bacure.core.html#var-remote-objects"><span>remote-objects</span></a></li><li><a href="bacure.core.html#var-remote-objects-all-properties"><span>remote-objects-all-properties</span></a></li><li><a href="bacure.core.html#var-remove-all-objects"><span>remove-all-objects</span></a></li><li><a href="bacure.core.html#var-remove-object"><span>remove-object</span></a></li><li><a href="bacure.core.html#var-reset-local-device"><span>reset-local-device</span></a></li><li><a href="bacure.core.html#var-save-local-device-backup"><span>save-local-device-backup</span></a></li><li><a href="bacure.core.html#var-set-remote-properties"><span>set-remote-properties</span></a></li><li><a href="bacure.core.html#var-terminate"><span>terminate</span></a></li><li><a href="bacure.core.html#var-where"><span>where</span></a></li><li><a href="bacure.core.html#var-where-or-not-found"><span>where-or-not-found</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>bacure.core documentation</h2><pre class="doc"></pre><div class="public" id="var-add-object"><h3>add-object</h3><div class="usage"><code>(add-object object-map)</code></div><pre class="doc">Add a local object and return it. You should probably just use `add-or-update-object'.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L93">Source</a></div></div><div class="public" id="var-add-or-update-object"><h3>add-or-update-object</h3><div class="usage"><code>(add-or-update-object object-map)</code></div><pre class="doc">Update a local object properties. Create the object it if not
already present. Will not try to modify any :object-type
or :object-identifier.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L102">Source</a></div></div><div class="public" id="var-boot-up"><h3>boot-up</h3><div class="usage"><code>(boot-up)</code></div><pre class="doc">Create a local-device, load its config file, initialize it, and find the remote devices.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L189">Source</a></div></div><div class="public" id="var-clear-all%21"><h3>clear-all!</h3><div class="usage"><code>(clear-all!)</code></div><pre class="doc">Mostly a development function; Destroy all traces of a local-device.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L157">Source</a></div></div><div class="public" id="var-create-remote-object"><h3>create-remote-object</h3><div class="usage"><code>(create-remote-object device-id object-map)</code></div><pre class="doc">Send a 'create object request' to the remote device.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L223">Source</a></div></div><div class="public" id="var-delete-remote-object"><h3>delete-remote-object</h3><div class="usage"><code>(delete-remote-object device-id object-identifier)</code></div><pre class="doc">Send a 'delete object' request to a remote device.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L231">Source</a></div></div><div class="public" id="var-find-objects"><h3>find-objects</h3><div class="usage"><code>(find-objects device-id criteria-map)</code><code>(find-objects device-id criteria-map object-identifiers)</code></div><pre class="doc">Return a list of objects-maps (properties) matching the criteria-map.

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #&quot;(?i)analog&quot; :model-name &quot;GNU&quot;}

Each different* property is requested individually, which requires
a higher traffic on the network. However, it also enables us to
stop a query if one of the properties values isn't what we wished.
Useful if we want to find devices with particular properties.

If the criteria-map fails, any unfetched properties will just be
dropped, saving some traffic on the network. Can quickly become
advantageous if we query a large number of devices.

* In case of multiple objects, if segmentation is supported, the
  same property is retrieved in a single request. For example, the
  `description' property for 3 different objects would be merged
  into a single request.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L369">Source</a></div></div><div class="public" id="var-find-objects-everywhere"><h3>find-objects-everywhere</h3><div class="usage"><code>(find-objects-everywhere criteria-map)</code><code>(find-objects-everywhere criteria-map object-identifiers)</code></div><pre class="doc">Same as `find-objects', but will search every known devices on the network.
Group the result in a map where the device object identifier is the
key. E.g. [:device 1234]

Thus, to retrieve the result for a given device, simply do:
(get &lt;result&gt; [:device 1234]).

One could also get the list of devices in which a result matched with:
(keys &lt;result&gt;).

Criteria-map example: {:present-value #(&gt; % 10) :object-name #&quot;(?i)analog&quot; :model-name &quot;GNU&quot;}</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L400">Source</a></div></div><div class="public" id="var-find-remote-devices"><h3>find-remote-devices</h3><div class="usage"><code>(find-remote-devices &amp; [{:keys [min-range max-range dest-port], :or {dest-port (:destination-port (clojure.core/deref local-device-configs))}}])</code></div><pre class="doc">We find remote devices by sending a 'WhoIs' broadcast. Every device
that responds is added to the remote-devices field in the
local-device. WARNING: This won't ask the device if it supports
read-property-multiple. Thus, any property read based solely on this
remote device discovery might fail. The use of
`find-remote-devices-and-services-supported' is highly recommended, even if it
might take a little longer to execute.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L71">Source</a></div></div><div class="public" id="var-find-remote-devices-and-extended-information"><h3>find-remote-devices-and-extended-information</h3><div class="usage"><code>(find-remote-devices-and-extended-information &amp; [{:keys [min-range max-range dest-port], :as args}])</code></div><pre class="doc">Given a local device, sends a WhoIs. For every device discovered,
get its extended information. Return the remote devices as a list.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L176">Source</a></div></div><div class="public" id="var-initialize"><h3>initialize</h3><div class="usage"><code>(initialize)</code></div><pre class="doc">Initialize the local device. This will bind it to it's port (most
likely 47808). The port will remain unavailable until the device is
terminated. Once terminated, you should discard the device and
create a new one if needed.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L59">Source</a></div></div><div class="public" id="var-load-local-device-backup"><h3>load-local-device-backup</h3><div class="usage"><code>(load-local-device-backup)</code></div><pre class="doc">Load the local-device backup file and reset it with this new configuration.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L170">Source</a></div></div><div class="public" id="var-local-device-backup"><h3>local-device-backup</h3><div class="usage"><code>(local-device-backup)</code></div><pre class="doc">Spit all important information about the local device into a map.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L123">Source</a></div></div><div class="public" id="var-local-objects"><h3>local-objects</h3><div class="usage"><code>(local-objects)</code></div><pre class="doc">Return a list of local objects
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L88">Source</a></div></div><div class="public" id="var-mapify"><h3>mapify</h3><h4 class="macro">macro</h4><div class="usage"><code>(mapify &amp; symbols)</code></div><pre class="doc">Given some symbols, construct a map with the symbols as keys, and
 the value of the symbols as the map values. For example:
(Let [aa 12]
    (mapify aa))
=&gt; {:aa 12}</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L16">Source</a></div></div><div class="public" id="var-new-local-device"><h3>new-local-device</h3><div class="usage"><code>(new-local-device)</code><code>(new-local-device configs-map)</code></div><pre class="doc">Return a new configured BACnet local device . (A device is required
to communicate over the BACnet network.). To terminate it, use the
java method `terminate'. If needed, the initial configurations are
available in the atom 'local-device-configs.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L35">Source</a></div></div><div class="public" id="var-rd"><h3>rd</h3><div class="usage"><code>(rd device-id)</code></div><pre class="doc">Get the remote device by its device-id
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L205">Source</a></div></div><div class="public" id="var-remote-devices"><h3>remote-devices</h3><div class="usage"><code>(remote-devices)</code></div><pre class="doc">Return the list of the current remote devices. These devices must
be in the local table. To scan a network, use
`find-remote-devices-and-extended-information'.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L198">Source</a></div></div><div class="public" id="var-remote-devices-and-names"><h3>remote-devices-and-names</h3><div class="usage"><code>(remote-devices-and-names)</code></div><pre class="doc">Return a list of vector pair with the device-id and its name.
--&gt;  ([1234 &quot;SimpleServer&quot;])</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L210">Source</a></div></div><div class="public" id="var-remote-object-properties"><h3>remote-object-properties</h3><div class="usage"><code>(remote-object-properties device-id object-identifiers properties)</code></div><pre class="doc">Query a remote device and return the properties values
Example: (remote-object-properties 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers' and `properties' accept either a single
item or a collection.

Discards any properties with a `nil' value (property not found in object).</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L276">Source</a></div></div><div class="public" id="var-remote-object-properties-with-nil"><h3>remote-object-properties-with-nil</h3><div class="usage"><code>(remote-object-properties-with-nil device-id object-identifiers properties)</code></div><pre class="doc">Query a remote device and return the properties values
Example: (object-properties-values 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers' and `properties' accept either a single
item or a collection.

You probably want to use `remote-object-properties'.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L261">Source</a></div></div><div class="public" id="var-remote-objects"><h3>remote-objects</h3><div class="usage"><code>(remote-objects device-id)</code></div><pre class="doc">Return a map of every objects in the remote device.
-&gt; [[:device 1234] [:analog-input 0]...]</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L290">Source</a></div></div><div class="public" id="var-remote-objects-all-properties"><h3>remote-objects-all-properties</h3><div class="usage"><code>(remote-objects-all-properties device-id)</code></div><pre class="doc">Return a list of maps of every objects and their properties.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L297">Source</a></div></div><div class="public" id="var-remove-all-objects"><h3>remove-all-objects</h3><div class="usage"><code>(remove-all-objects)</code></div><pre class="doc">Remove all local object
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L118">Source</a></div></div><div class="public" id="var-remove-object"><h3>remove-object</h3><div class="usage"><code>(remove-object object-map)</code></div><pre class="doc">Remove a local object
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L113">Source</a></div></div><div class="public" id="var-reset-local-device"><h3>reset-local-device</h3><div class="usage"><code>(reset-local-device)</code><code>(reset-local-device new-config)</code></div><pre class="doc">Terminate the local device and discard it. Replace it with a new
local device, and apply the same configurations as the previous one.
If a map with new configurations is provided, it will be merged with
the old config.

(reset-local-device {:device-id 1112})
---&gt; reset the device and change the device id.</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L135">Source</a></div></div><div class="public" id="var-save-local-device-backup"><h3>save-local-device-backup</h3><div class="usage"><code>(save-local-device-backup)</code></div><pre class="doc">Save the device backup on a local file and return the config map.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L164">Source</a></div></div><div class="public" id="var-set-remote-properties"><h3>set-remote-properties</h3><div class="usage"><code>(set-remote-properties device-id properties-map)</code></div><pre class="doc">Set all the given objects properties in the remote device.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L302">Source</a></div></div><div class="public" id="var-terminate"><h3>terminate</h3><div class="usage"><code>(terminate)</code></div><pre class="doc">Terminate the local device, freeing any bound port in the process.
</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L66">Source</a></div></div><div class="public" id="var-where"><h3>where</h3><div class="usage"><code>(where criteria)</code></div><pre class="doc">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, fail.

For example:
Criteria map:  {:a #(&gt; % 10) :b &quot;foo&quot;}
Tested-maps  {:a 20 :b &quot;foo&quot;}  success
             {:b &quot;foo&quot;}        fail
             {:a nil :b &quot;foo&quot;} fail</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L331">Source</a></div></div><div class="public" id="var-where-or-not-found"><h3>where-or-not-found</h3><div class="usage"><code>(where-or-not-found criteria)</code></div><pre class="doc">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, pass.

For example:
Criteria map:  {:a #(&gt; % 10) :b &quot;foo&quot;}
Tested-maps  {:a 20 :b &quot;foo&quot;}  success
             {:b &quot;foo&quot;}        success
             {:a nil :b &quot;foo&quot;} fail</pre><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L345">Source</a></div></div></div></body></html>