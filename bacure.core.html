<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>bacure.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Bacure</span> <span class="project-version">1.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bacure</span></div></div></li><li class="depth-2"><a href="bacure.coerce.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coerce</span></div></a></li><li class="depth-3 branch"><a href="bacure.coerce.obj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>obj</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></div></li><li class="depth-4"><a href="bacure.coerce.service.acknowledgement.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>acknowledgement</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>type</span></div></div></li><li class="depth-4 branch"><a href="bacure.coerce.type.constructed.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>constructed</span></div></a></li><li class="depth-4 branch"><a href="bacure.coerce.type.enumerated.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>enumerated</span></div></a></li><li class="depth-4"><a href="bacure.coerce.type.primitive.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>primitive</span></div></a></li><li class="depth-2 branch current"><a href="bacure.core.html"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="bacure.local-device.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>local-device</span></div></a></li><li class="depth-2 branch"><a href="bacure.local-save.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>local-save</span></div></a></li><li class="depth-2 branch"><a href="bacure.network.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>network</span></div></a></li><li class="depth-2 branch"><a href="bacure.read-properties.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>read-properties</span></div></a></li><li class="depth-2"><a href="bacure.remote-device.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>remote-device</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="bacure.core.html#var-boot-up.21"><div class="inner"><span>boot-up!</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-find-bacnet-port"><div class="inner"><span>find-bacnet-port</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-find-objects"><div class="inner"><span>find-objects</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-find-objects-everywhere"><div class="inner"><span>find-objects-everywhere</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-get-device-id"><div class="inner"><span>get-device-id</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-object-properties"><div class="inner"><span>remote-object-properties</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-object-properties-with-error"><div class="inner"><span>remote-object-properties-with-error</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-objects"><div class="inner"><span>remote-objects</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-remote-objects-all-properties"><div class="inner"><span>remote-objects-all-properties</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-where"><div class="inner"><span>where</span></div></a></li><li class="depth-1"><a href="bacure.core.html#var-where-or-not-found"><div class="inner"><span>where-or-not-found</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">bacure.core</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-boot-up.21"><h3>boot-up!</h3><div class="usage"><code>(boot-up!)</code><code>(boot-up! configs)</code></div><div class="doc"><pre class="plaintext">Create a local-device, load its config file, initialize it, and
find the remote devices.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L8">view source</a></div></div><div class="public anchor" id="var-find-bacnet-port"><h3>find-bacnet-port</h3><div class="usage"><code>(find-bacnet-port)</code><code>(find-bacnet-port configs)</code></div><div class="doc"><pre class="plaintext">Scan ports to see if any BACnet device will respond. Use port
numbers as device-id.

Example use:
(find-bacnet-port) ;;will scan ports 47801 to 47820
(find-bacnet-port {:delay 100}) ;; scan the same ports, but faster
(find-bacnet-port {:port-min 47850 :port-max 47900}) ;;new port range

The argument is a map of configs for the BACnet devices that will be
created (like in `bacure.local-device/new-local-device!'), but it
will also accepts these additional fields :

- :port-min
- :port-max
- :delay

If the optionals port-min and port-max aren't
given, default to all ports between 47801 and 47820.

By default each port will wait 500 ms for an answer.

Even if we could simply send a WhoIs on another port, some BACnet
devices have bad behaviour and send data back to 'their' port,
regardless from which port the WhoIs came. In other to maximize our
chances of finding them, we reset the local device with a new port
each time.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L19">view source</a></div></div><div class="public anchor" id="var-find-objects"><h3>find-objects</h3><div class="usage"><code>(find-objects device-id criteria-map)</code><code>(find-objects device-id criteria-map object-identifiers)</code></div><div class="doc"><pre class="plaintext">Return a list of objects-maps (properties) matching the criteria-map.

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #"(?i)analog" :model-name "GNU"}

Each different* property is requested individually, which requires
a higher traffic on the network. However, it also enables us to
stop a query if one of the properties values isn't what we wished.
Useful if we want to find devices with particular properties.

If the criteria-map fails, any unfetched properties will just be
dropped, saving some traffic on the network. Can quickly become
advantageous if we query a large number of devices.

* In case of multiple objects, if segmentation is supported, the
  same property is retrieved in a single request. For example, the
  `description' property for 3 different objects would be merged
  into a single request.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L200">view source</a></div></div><div class="public anchor" id="var-find-objects-everywhere"><h3>find-objects-everywhere</h3><div class="usage"><code>(find-objects-everywhere criteria-map)</code><code>(find-objects-everywhere criteria-map object-identifiers)</code></div><div class="doc"><pre class="plaintext">Same as `find-objects', but will search every known devices on the network.
Group the result in a map where the device object identifier is the
key. E.g. [:device 1234]

Thus, to retrieve the result for a given device, simply do:
(get &lt;result&gt; [:device 1234]).

One could also get the list of devices in which a result matched with:
(keys &lt;result&gt;).

Criteria-map example:
{:present-value #(&gt; % 10) :object-name #"(?i)analog" :model-name "GNU"}

All remote devices are queried simultaneously (or as much as the
local-device can allow).</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L234">view source</a></div></div><div class="public anchor" id="var-get-device-id"><h3>get-device-id</h3><div class="usage"><code>(get-device-id device-map)</code></div><div class="doc"><pre class="plaintext">Return the device-id from a device-map (bunch of properties).

This can be used to search the device-id amongst all the properties
returned by (remote-objects-all-properties &lt;some-device-id&gt;).</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L116">view source</a></div></div><div class="public anchor" id="var-remote-object-properties"><h3>remote-object-properties</h3><div class="usage"><code>(remote-object-properties device-id object-identifiers properties)</code><code>(remote-object-properties local-device-id device-id object-identifiers properties)</code></div><div class="doc"><pre class="plaintext">Query a remote device and return the properties values
 Example: (remote-object-properties 1234 [:analog-input 0] :all)
 -&gt; {:notification-class 4194303, :event-enable .....}

 Both `object-identifiers' and `properties' accept either a single
 item or a collection.

 Discards any properties with an error value 
(example: property not found in object).</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L82">view source</a></div></div><div class="public anchor" id="var-remote-object-properties-with-error"><h3>remote-object-properties-with-error</h3><div class="usage"><code>(remote-object-properties-with-error device-id object-identifiers properties)</code><code>(remote-object-properties-with-error local-device-id device-id object-identifiers properties)</code></div><div class="doc"><pre class="plaintext">Query a remote device and return the properties values
Example: (remote-object-properties-with-error 1234 [:analog-input 0] :all)
-&gt; {:notification-class 4194303, :event-enable .....}

Both `object-identifiers' and `properties' accept either a single
item or a collection.

You probably want to use `remote-object-properties'.</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L65">view source</a></div></div><div class="public anchor" id="var-remote-objects"><h3>remote-objects</h3><div class="usage"><code>(remote-objects device-id)</code><code>(remote-objects local-device-id device-id)</code></div><div class="doc"><pre class="plaintext">Return a collection of every objects in the remote device.
-&gt; [[:device 1234] [:analog-input 0]...]</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L101">view source</a></div></div><div class="public anchor" id="var-remote-objects-all-properties"><h3>remote-objects-all-properties</h3><div class="usage"><code>(remote-objects-all-properties device-id)</code><code>(remote-objects-all-properties local-device-id device-id)</code></div><div class="doc"><pre class="plaintext">Return a list of maps of every objects and their properties.
</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L110">view source</a></div></div><div class="public anchor" id="var-where"><h3>where</h3><div class="usage"><code>(where criteria)</code></div><div class="doc"><pre class="plaintext">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, fail.

For example:
Criteria map:  {:a #(&gt; % 10) :b "foo"}
Tested-maps  {:a 20 :b "foo"}  success
             {:b "foo"}        fail
             {:a nil :b "foo"} fail</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L162">view source</a></div></div><div class="public anchor" id="var-where-or-not-found"><h3>where-or-not-found</h3><div class="usage"><code>(where-or-not-found criteria)</code></div><div class="doc"><pre class="plaintext">Will test with criteria map as a predicate. If the value of a
key-val pair is a function, use it as a predicate. If the tested map
value is not found, pass.

For example:
Criteria map:  {:a #(&gt; % 10) :b "foo"}
Tested-maps  {:a 20 :b "foo"}  success
             {:b "foo"}        success
             {:a nil :b "foo"} fail</pre></div><div class="src-link"><a href="https://github.com/Frozenlock/bacure/blob/master/src/bacure/core.clj#L176">view source</a></div></div></div></body></html>